angular.module("liztube",["liztube.constants","liztube.themes","liztube.utils","liztube.menu","liztube.home","liztube.search","liztube.user","liztube.partial","ngRoute","ngMessages","angularjs-gravatardirective","liztube.videos.module"]).config(["$routeProvider","$locationProvider","RestangularProvider",function(e,t,i){t.html5Mode(!0),i.setBaseUrl("api/"),i.addResponseInterceptor(function(e,t,i,o,n,r){var a;return"getList"===t?(a=e.videos,a.currentPage=e.currentPage,a.videosTotalCount=e.videosTotalCount,a.totalPage=e.totalPage):a=e,a})}]).controller("mainCtrl",["$scope",function(e){e.$on("loadingStatus",function(t,i){e.$broadcast("loadingStatusForHeader",i)}),e.$on("userStatus",function(t,i){e.$broadcast("userIsConnected",i)}),e.$on("loadingUploadVideo",function(t,i){e.$broadcast("loadingUploadVideoForHeader",i)}),e.$on("addNotification",function(t,i){e.$broadcast("addNotificationForHeader",i)}),e.$on("removeNotification",function(t,i){e.$broadcast("removeNotificationForHeader",i)})}]).run(["$rootScope","$window","$location",function(e,t,i){e.$on("$routeChangeStart",function(o,n,r){n.$$route&&n.$$route.resolve&&(e.isViewLoading=!0),n.hasOwnProperty("$$route")&&(""!==t.user.pseudo||n.$$route.accessAnonymous||i.path("/login"))}),e.$on("$routeChangeSuccess",function(t,i,o){e.isViewLoading=!1,i.hasOwnProperty("$$route")&&(e.title=i.$$route.title,e.page=i.$$route.page)})}]),angular.module("liztube.constants",[]).constant("constants",{SERVER_ERROR:"Une erreur inattendue est survenue. Si le problème persiste veuillez contacter l'équipe de Liztube.",FILE_TYPE_ERROR:'Veuillez sélectionner une vidéo de type "mp4"',FILE_SIZE_ERROR:"La taille de la vidéo ne doit pas dépasser 500 Mo",NO_FILE_SELECTED:"Aucune vidéo sélectionnée",FILE_SIZE_ALLOWED:524288e3,UPLOAD_DONE:"Téléchargement de la vidéo terminé",DOWNLOAD_ON_AIR_FILE_NAME:"Téléchargement de la vidéo : ",NO_NOTIFICATIONS_FOUND:"Vous n'avez aucune notification",UPDATE_PASSWORD_OK:"Votre mot de passe a bien été mis à jour",UPDATE_PASSWORD_NOK_OLD_PASSWORD:"Votre ancien mot de passe ne correspond pas",WRONG_PASSWORD:"Mot de passe incorrect",SUCCESS_DELETE:"Votre profil a bien été supprimé",UPDATE_PROFILE_OK:"Votre profil a bien été mis à jour",UPDATE_VIDEO_DESCRIPTION_OK:"Votre vidéo a bien été mise à jour",NO_VIDEOS_FOUND:"Aucune vidéos trouvées",VIDEO_NOT_EXISTS:"Vidéo indisponible",VIDEO_SHARE_URL_CLIPPED:"Le lien de la vidéo a automatiquement été copié",LOGIN_FAILED:"Login ou mot de passe incorrect"}),angular.module("liztube.dataService.authService",["restangular"]).factory("authService",["Restangular",function(e){function t(){return e.one("auth")}function i(){return t().one("currentProfil").get()}function o(e,t){return s.one("login").customPOST("username="+e+"&password="+t,void 0,void 0,{"Content-Type":"application/x-www-form-urlencoded"})}function n(e){return t().post("signin",e)}function r(e){var i={value:e};return t().post("email",i)}function a(e){var i={value:e};return t().post("pseudo",i)}function l(){return s.one("logout").get()}var s=e.withConfig(function(e){e.setBaseUrl("/")});return{login:o,register:n,currentUser:i,logout:l,emailExist:r,pseudoExist:a}}]),angular.module("liztube.dataService.userService",["restangular"]).factory("userService",["Restangular",function(e){function t(){return e.one("user")}function i(){return t().get()}function o(e){return t().customPUT(e)}function n(e){return t().one("password").patch(e)}function r(e){var t={value:e};return baseAuth().post("email",t)}function a(e){return t().post("delete",e)}return{userProfile:i,updateProfile:o,emailExistUpdate:r,updatePassword:n,deleteUser:a}}]),angular.module("liztube.dataService.videosService",["restangular"]).factory("videosService",["Restangular",function(e){function t(){return e.one("video")}function i(e,i){return t().one("search").getList(e,i)}function o(e){return t().customGET(e)}function n(e){return t().customPUT(e)}return{getVideos:i,getVideoData:o,updateVideoData:n}}]),angular.module("liztube.themes",["ngMaterial"]).config(["$mdThemingProvider",function(e){e.definePalette("liztubePalette",{50:"ffebee",100:"ffcdd2",200:"ef9a9a",300:"e57373",400:"ef5350",500:"333333",600:"e53935",700:"d32f2f",800:"c62828",900:"b71c1c",A100:"ff8a80",A200:"ff5252",A400:"ff1744",A700:"d50000",contrastDefaultColor:"dark",contrastDarkColors:["50","100","200","300","400","A100"],contrastLightColors:"light"}),e.theme("default").primaryPalette("liztubePalette").accentPalette("blue",{"default":"700"}).warnPalette("red",{"default":"800"}),e.theme("navbar").primaryPalette("grey",{"default":"200"}).accentPalette("grey",{"default":"900"}).warnPalette("red",{"default":"800"}),e.theme("sub-bar").primaryPalette("grey",{"default":"600"}).accentPalette("blue-grey",{"default":"500"}).warnPalette("red",{"default":"800"}),e.setDefaultTheme("default")}]),angular.module("liztube.date",[]).directive("dateToTimestamp",function(){return{require:"ngModel",link:function(e,t,i,o){o.$parsers.push(function(e){var t=Date.parse(e),i=new Date,n=Date.parse(i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear());return t>=n?void o.$setValidity("dateToTimestamp",!1):(o.$setValidity("dateToTimestamp",!0),Date.parse(e))})}}}),angular.module("liztube.utils",["liztube.date"]),angular.module("liztube.home",["ngRoute"]).config(["$routeProvider",function(e){e.when("/",{title:"LizTube - Accueil",page:"Accueil",accessAnonymous:!0,controller:"homeCtrl",templateUrl:"home.html"}).otherwise({redirectTo:"/404",title:"LizTube - 404",page:"404 : Page non trouvée",templateUrl:"404.html"})}]).controller("homeCtrl",["$scope",function(e){e.pageTitle="Suggestions Liztube",e.orderBy="q",e.page="1",e.pagination="20",e.userId="",e.q="",e["for"]="home"}]),angular.module("liztube.search",["ngRoute"]).config(["$routeProvider",function(e){e.when("/search/:search",{title:"LizTube - Recherche",page:"Recherche",accessAnonymous:!0,controller:"searchCtrl",templateUrl:"search.html"})}]).controller("searchCtrl",["$scope","$routeParams",function(e,t){e.pageTitle="Vidéos les plus récentes",e.orderBy="mostrecent",e.page="1",e.pagination="20",e.userId="",e.q=t.search,e["for"]="home"}]),angular.module("liztube.menu",["liztube.header","liztube.footer"]),angular.module("liztube.user",["liztube.login","liztube.register","liztube.profile","liztube.updatepassword"]),angular.module("liztube.videos.module",["liztube.upload.video","liztube.videos.watch"]),angular.module("liztube.moastr",[]).factory("moastr",["$mdToast",function(e){function t(t,i){e.show({template:'<md-toast class="moastr full error"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}function i(t,i){e.show({template:'<md-toast class="moastr full success"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}function o(t,i){e.show({template:'<md-toast class="moastr full info"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}function n(t,i){e.show({template:'<md-toast class="moastr min error"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}function r(t,i){e.show({template:'<md-toast class="moastr min success"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}function a(t,i){e.show({template:'<md-toast class="moastr min info"><span flex><i class="fa fa-exclamation-triangle"></i> '+t+"</span></md-toast>",hideDelay:6e3,position:i})}return{error:t,success:i,info:o,errorMin:n,successMin:r,infoMin:a}}]),angular.module("liztube.userStatus",["liztube.dataService.authService","liztube.moastr","ngRoute"]).controller("connectedCtrl",["$scope","$rootScope","$window","authService","$location","$mdSidenav","moastr","constants",function(e,t,i,o,n,r,a,l){e.$on("userIsConnected",function(t,i){_.isUndefined(i)?(e.pseudo="",e.email="",e.userConnected=!1):(e.pseudo=i.pseudo,e.email=i.email,e.userConnected=!0)}),e.logOut=function(){o.logout().then(function(){e.$emit("userStatus",void 0),i.user.pseudo="",n.path("/")},function(){a.error(l.SERVER_ERROR,"left right bottom")})},e.close=function(){r("right").close()},e.checkUserConnected=function(){e.pseudo||(i.user.pseudo?(e.pseudo=i.user.pseudo,e.email=i.user.email,e.userConnected=!0):e.userConnected=!1)}}]).directive("isConnected",function(){return{restrict:"E",controller:"connectedCtrl",templateUrl:"connected.html",scope:{type:"@"}}}),angular.module("liztube.footer",[]).controller("footerCtrl",["$scope",function(e){}]).directive("footer",function(){return{restrict:"E",controller:"footerCtrl",templateUrl:"footer.html"}}),angular.module("liztube.header",["liztube.userStatus"]).controller("headerCtrl",["$scope","$mdSidenav","constants","$location",function(e,t,i,o){e.notification=0,e.showNotification=!1,e.isLoading=!1,e.noNotification=i.NO_NOTIFICATIONS_FOUND,e.$on("addNotificationForHeader",function(t,i){e.showNotification=i,e.notification=e.notification+1,e.noNotification=""}),e.$on("removeNotificationForHeader",function(t,o){e.notification>0&&(e.notification=e.notification-1,0===e.notification?(e.showNotification=!1,e.noNotification=i.NO_NOTIFICATIONS_FOUND):e.noNotification="")}),e.$on("loadingStatusForHeader",function(t,i){e.isLoading=i}),e.toggleRight=function(){t("right").toggle()},e.closeRightBar=function(){t("right").close()},e.escapeChar=function(e){var t={"&":"","<":"",">":"",'"':"","'":"","/":""};return String(e).replace(/[&<>"'\/]/g,function(e){return t[e]})},e.search=function(){o.path(""===e.query||_.isUndefined(e.query)?"/":"/search/"+e.escapeChar(e.query))}}]).directive("header",function(){return{restrict:"E",controller:"headerCtrl",templateUrl:"header.html"}}),angular.module("liztube.login",["liztube.dataService.authService","liztube.moastr","ngRoute"]).config(["$routeProvider",function(e){e.when("/login",{title:"LizTube - Connexion",page:"Connexion",controller:"loginCtrl",templateUrl:"login.html"})}]).controller("loginCtrl",["$scope","$rootScope","$location","authService","$window","moastr","constants",function(e,t,i,o,n,r,a){e.errorLogin="",e.submit=function(){e.$emit("loadingStatus",!0),o.login(e.login,e.password).then(function(){o.currentUser().then(function(t){n.user=t,e.$emit("userStatus",t),i.path("/")},function(){r.error(a.SERVER_ERROR,"left right bottom")})},function(){r.error(a.LOGIN_FAILED,"left right bottom")})["finally"](function(){e.$emit("loadingStatus",!1)})}}]),angular.module("liztube.profile",["liztube.moastr","liztube.dataService.userService","liztube.videos","ngMessages"]).config(["$routeProvider",function(e){e.when("/profil",{title:"LizTube - Profil",page:"Profil",controller:"profileCtrl",templateUrl:"profile.html"})}]).controller("profileCtrl",["$scope","$rootScope","userService","$location","moastr","constants","$window","$mdDialog",function(e,t,i,o,n,r,a,l){function s(e,l){e.hide=function(){l.hide()},e.cancel=function(){l.cancel()},e.answer=function(s){l.hide(s),t.$broadcast("loadingStatus",!0),i.deleteUser(e.password).then(function(){n.successMin(r.SUCCESS_DELETE,"top right"),e.$emit("userStatus",void 0),a.user.pseudo="",o.path("/")},function(){n.error(r.WRONG_PASSWORD,"left right bottom")})["finally"](function(){t.$broadcast("loadingStatus",!1)})}}e.pageTitle="Mes vidéos",e.orderBy="mostrecent",e.page="1",e.pagination="20",e.userId=a.user.id,e.q="",e["for"]="user",e.errorUpdate="",e.isDisable=!0,e.profilTitle="Profil",e.enableUpdateProfil=function(){e.profilTitle="Mise à jour du profil",e.isDisable=!1};var u=function(){e.profilTitle="Profil",e.isDisable=!0};e.getUserProfile=function(){i.userProfile().then(function(t){e.user=t;var i=new Date(e.user.birthdate);e.user.birthdate=new Date(i.getFullYear(),i.getMonth(),i.getDate())},function(){n.error(r.SERVER_ERROR,"left right bottom")})},e.update=function(){t.$broadcast("loadingStatus",!0),i.updateProfile(e.user).then(function(){n.successMin(r.UPDATE_PROFILE_OK,"top right")},function(){n.error(r.SERVER_ERROR,"left right bottom")})["finally"](function(){t.$broadcast("loadingStatus",!1),u()})},e.showAdvanced=function(e){l.show({controller:s,templateUrl:"dialog.delete.user.html",parent:angular.element(document.body),targetEvent:e})}}]).directive("emailValidation",["userService","moastr",function(e,t){return{require:"ngModel",link:function(i,o,n,r){r.$asyncValidators.emailValid=function(i,o){var n=i||o;return e.emailExistUpdate(n).then(function(e){return e?void r.$setValidity("emailValidation",!1):(r.$setValidity("emailValidation",!0),o)},function(){t.error(constants.SERVER_ERROR,"left right bottom")})}}}}]),angular.module("liztube.register",["ngRoute","liztube.moastr","liztube.dataService.authService","ngMessages"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/register",{title:"LizTube - Inscription",page:"Inscription",accessAnonymous:!0,controller:"registerCtrl",templateUrl:"register.html"})}]).controller("registerCtrl",["$scope","$rootScope","authService","$location","moastr","constants",function(e,t,i,o,n,r){e.errorRegister="",e.register=function(){t.$broadcast("loadingStatus",!0),i.register(e.user).then(function(){o.path("/login")},function(){n.error(r.SERVER_ERROR,"left right bottom")})["finally"](function(){t.$broadcast("loadingStatus",!1)})}}]).directive("passwordVerify",function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(e,t,i,o){e.$watch(function(){var t;return(e.passwordVerify||o.$viewValue)&&(t=e.passwordVerify+"_"+o.$viewValue),t},function(t){t&&o.$parsers.unshift(function(t){var i=e.passwordVerify;return i!==t?void o.$setValidity("passwordVerify",!1):(o.$setValidity("passwordVerify",!0),t)})})}}}).directive("emailValidation",["authService","moastr",function(e,t){return{require:"ngModel",link:function(i,o,n,r){r.$asyncValidators.emailValid=function(i,o){var n=i||o,a=function(){return e.emailExist(n).then(function(e){return e?void r.$setValidity("emailValidation",!1):(r.$setValidity("emailValidation",!0),o)},function(){t.error(constants.SERVER_ERROR,"left right bottom")})};return a()}}}}]).directive("pseudoValidation",["authService","moastr",function(e,t){return{require:"ngModel",link:function(i,o,n,r){r.$asyncValidators.pseudoValid=function(i,o){var n=i||o,a=function(){return e.pseudoExist(n).then(function(e){return e?void r.$setValidity("pseudoValidation",!1):(r.$setValidity("pseudoValidation",!0),o)},function(){t.error(constants.SERVER_ERROR,"left right bottom")})};return a()}}}}]),angular.module("liztube.updatepassword",["liztube.moastr","liztube.dataService.userService","ngMessages"]).config(["$routeProvider",function(e){e.when("/majmotdepasse",{title:"LizTube - Mise à jour du mot de passe",page:"Mise à jour du mot de passe",controller:"updatePasswordCtrl",templateUrl:"updatepassword.html"})}]).controller("updatePasswordCtrl",["$scope","$rootScope","userService","$location","moastr","constants",function(e,t,i,o,n,r){e.errorUpdate="",e.password={newPassword:"",oldPassword:""},e.verify={password:""},e.update=function(){t.$broadcast("loadingStatus",!0),i.updatePassword(e.password).then(function(){n.successMin(r.UPDATE_PASSWORD_OK,"top right"),o.path("/profil")},function(e){"#1015"===e.data.messages[0]?n.error(r.UPDATE_PASSWORD_NOK_OLD_PASSWORD,"left right bottom"):n.error(r.SERVER_ERROR,"left right bottom")})["finally"](function(){e.$emit("loadingStatus",!1)})}}]),angular.module("liztube.videos",["liztube.dataService.videosService","liztube.moastr"]).controller("videosCtrl",["$scope","constants","videosService","moastr","$window",function(e,t,i,o,n){e.parameters={},e.flexSize=20,e.noVideoFound="",e.videos=[],e.videosLoading=!1,e.getFlexSize=function(t){500>=t?e.flexSize=100:t>=500&&800>=t?e.flexSize=50:t>=800&&1300>=t?e.flexSize=33:e.flexSize=20},e.getFlexSize(n.innerWidth),e.getParams=function(t){e.videosLoading=!0,_.isUndefined(t["for"])||"user"!==t["for"]?e.showConfidentiality=!1:e.showConfidentiality=!0,_.isUndefined(t["for"])||"home"!==t["for"]?e.showSelectVideos=!1:e.showSelectVideos=!0,_.isUndefined(t.pageTitle)||""===t.pageTitle?e.pageTitle="Liztube vidéos":e.pageTitle=t.pageTitle,_.isUndefined(t.orderBy)||""===t.orderBy?e.orderBy="q":e.orderBy=t.orderBy,_.isUndefined(t.page)||""===t.page||(e.parameters.page=t.page),_.isUndefined(t.pagination)||""===t.pagination||(e.parameters.pagination=t.pagination),_.isUndefined(t.user)||""===t.user||(e.parameters.user=t.user),_.isUndefined(t.q)||""===t.q||(e.parameters.q=n.encodeURIComponent(t.q)),e.getVideos(e.parameters)},e.getVideos=function(r){i.getVideos(e.orderBy,r).then(function(i){0!==i.length||!_.isUndefined(r.q)&&""!==r.q?0!==i.length||_.isUndefined(r.q)&&""===r.q?(e.videos=e.videos.concat(i),e.loadPage=i.currentPage+1,e.totalPage=i.totalPage):e.noVideoFound=t.NO_VIDEOS_FOUND+" pour la recherche '"+n.decodeURIComponent(r.q)+"'":e.noVideoFound=t.NO_VIDEOS_FOUND},function(){o.error(t.SERVER_ERROR,"left right bottom")})["finally"](function(){e.videosLoading=!1})},e.filter=function(t){"1"===t?(e.orderBy="q",e.pageTitle="Suggestions Liztube"):"2"===t?(e.orderBy="mostrecent",e.pageTitle="Vidéos les plus récentes"):"3"===t?(e.orderBy="mostviewed",e.pageTitle="Vidéos les plus vues"):"4"===t&&(e.orderBy="mostshared",e.pageTitle="Vidéos les plus partagées"),e.videos=[],e.getParams({pageTitle:e.pageTitle,orderBy:e.orderBy,page:1,pagination:e.pagination,user:e.user,q:e.q,"for":e["for"]})}}]).directive("liztubeVideos",["$window",function(e){return{restrict:"E",controller:"videosCtrl",templateUrl:"videosDirective.html",replace:!0,scope:{pageTitle:"@",orderBy:"@",page:"@",pagination:"@",user:"@",q:"@","for":"@"},link:function(t,i,o){t.getParams({pageTitle:t.pageTitle,orderBy:t.orderBy,page:t.page,pagination:t.pagination,user:t.user,q:t.q,"for":t["for"]}),e.addEventListener("resize",function(){t.getFlexSize(i[0].offsetWidth),t.$apply()})}}}]).filter("formatTime",function(){return function(e){var t=parseInt(e/1e3%60),i=parseInt(e/6e4%60),o=parseInt(e/36e5%24),n="";return o=10>o&&o>0?"0"+o:o,i=10>i?"0"+i:i,t=10>t?"0"+t:t,n=0===o?i+":"+t:o+":"+i+":"+t}}).directive("infiniteScroll",["$window",function(e){return function(t,i,o){angular.element(e).bind("scroll",function(){e.document.body.scrollHeight===e.document.body.offsetHeight+e.document.body.scrollTop&&t.loadPage<=t.totalPage&&t.getParams({pageTitle:t.pageTitle,orderBy:t.orderBy,page:t.loadPage,pagination:t.pagination,user:t.user,q:t.q,"for":t["for"]})})}}]),angular.module("liztube.videos.watch",["ngRoute","liztube.moastr","liztube.dataService.videosService","ngSanitize","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster","ngClipboard"]).config(["$routeProvider",function(e){e.when("/watch/:videoKey",{title:"LizTube - Vidéo",page:"vidéo",controller:"watchCtrl",templateUrl:"watch.html",accessAnonymous:!0})}]).config(["ngClipProvider",function(e){e.setPath("app/dist/libs/zeroclipboard/dist/ZeroClipboard.swf")}]).controller("watchCtrl",["$sce","$rootScope","$scope","$routeParams","$route","moastr","videosService","constants","$location","$mdDialog",function(e,t,i,o,n,r,a,l,s,u){function c(e,t){e.urlForSharing=" "+s.absUrl()+" ",e.hide=function(){t.hide()},e.cancel=function(){t.cancel()},e.answer=function(e){t.hide(e),r.successMin(l.VIDEO_SHARE_URL_CLIPPED,"top right")}}i.errorUpdate="",i.isEnableEditingVideo=!1,i.showLink=function(e){u.show({controller:c,templateUrl:"dialogs.html",parent:angular.element(document.body),targetEvent:e}).then(function(e){},function(){})},i.enableEditVideo=function(){i.isEnableEditingVideo=!0,i.videoDesc["public"]?i.videoDesc.confidentiality=1:!i.videoDesc["public"]&&i.videoDesc.publicLink?i.videoDesc.confidentiality=2:i.videoDesc.confidentiality=0};var d=function(e){return null!==window.user&&e==window.user.pseudo?!0:!1},f=o.videoKey;i.getVideoDesc=function(){a.getVideoData(f).then(function(t){i.videoDesc=t,i.editVideo=d(t.ownerPseudo),i.config={sources:[{src:e.trustAsResourceUrl("/api/video/watch/"+f),type:"video/mp4"}],theme:"/app/dist/libs/videogular-themes-default/videogular.css",plugins:{poster:"/api/video/thumbnail/"+f+"?width=1280&height=720",controls:{autoHide:!0,autoHideTime:5e3}}}},function(e){"#1101"===e.data.messages[0]?(r.error(l.VIDEO_NOT_EXISTS,"left right bottom"),s.path("/")):"#1100"===e.data.messages[0]?(r.error(l.VIDEO_NOT_EXISTS,"left right bottom"),s.path("/")):r.error(l.SERVER_ERROR,"left right bottom")})},i.updateVideoDesc=function(){t.$broadcast("loadingStatus",!0),1==i.videoDesc.confidentiality?(i.videoDesc["public"]=!0,i.videoDesc.publicLink=!0):2==i.videoDesc.confidentiality?(i.videoDesc["public"]=!1,i.videoDesc.publicLink=!0):(i.videoDesc["public"]=!1,i.videoDesc.publicLink=!1),delete i.videoDesc.confidentiality,a.updateVideoData(i.videoDesc).then(function(){r.successMin(l.UPDATE_VIDEO_DESCRIPTION_OK,"top right"),i.isEnableEditingVideo=!1},function(){r.error(l.SERVER_ERROR,"left right bottom")})["finally"](function(){t.$broadcast("loadingStatus",!1)})}}]),angular.module("liztube.upload.video",["liztube.moastr","ngRoute","liztube.upload.video.page","angularFileUpload"]).controller("uploadVideoCtrl",["$scope","$http","$upload","constants","moastr","$mdSidenav","$location",function(e,t,i,o,n,r,a){e.uploadRate=0,e.id=0,e.notifications={infos:[]},e.$on("loadingUploadVideoForHeader",function(t,l){r("right").toggle(),e.id=e.id+1,e.$emit("addNotification",!0),e.notifications.infos.push({id:e.id,fileName:o.DOWNLOAD_ON_AIR_FILE_NAME+l.title,uploadRate:0,percent:"0%",videoKey:""}),i.upload({url:"/api/video/upload",fields:{title:l.title,description:l.description,isPublic:l.isPublic,isPublicLink:l.isPublicLink},file:l.file}).progress(function(t){e.addVideoAsNotifications({id:e.id,fileName:o.DOWNLOAD_ON_AIR_FILE_NAME+l.title,uploadRate:parseInt(99*t.loaded/t.total),percent:parseInt(99*t.loaded/t.total)+"%",videoKey:""})}).success(function(t,i,r,s){e.addVideoAsNotifications({id:e.id,fileName:o.UPLOAD_DONE+l.title,uploadRate:100,percent:"100%",videoKey:t}),n.successMin(o.UPLOAD_DONE,"top right"),a.path("/profil")}).error(function(e,t,i,r){n.error(o.SERVER_ERROR,"left right bottom")})}),e.addVideoAsNotifications=function(t){for(var i=0;i<e.notifications.infos.length;i++)angular.equals(e.notifications.infos[i].id,t.id)&&(e.notifications.infos[i].fileName=t.fileName,e.notifications.infos[i].uploadRate=t.uploadRate,e.notifications.infos[i].percent=t.percent,e.notifications.infos[i].videoKey=t.videoKey)},e.hideProgressBar=function(t){e.notifications.infos.splice(t,1),e.$emit("removeNotification",!0)}}]).directive("uploadVideo",function(){return{restrict:"E",controller:"uploadVideoCtrl",templateUrl:"uploadVideo.html",scope:{type:"@"}}}),angular.module("liztube.upload.video.page",["liztube.moastr","ngRoute"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/upload",{title:"LizTube - Upload",page:"Upload",controller:"FileUploadController",templateUrl:"upload.html"})}]).controller("FileUploadController",["$rootScope","$scope","moastr","constants","$location",function(e,t,i,o,n){t.isPublic=!1,t.isPublicLink=!1,t.fileName="",t.video={confidentiality:"1"},t.submit=function(){if(t.video.files&&t.video.files.length){"0"==t.video.confidentiality?(t.isPublic=!1,t.isPublicLink=!1):"1"==t.video.confidentiality?(t.isPublic=!0,t.isPublicLink=!0):(t.isPublic=!1,t.isPublicLink=!0);var e={file:t.video.files[0],title:t.video.title,description:t.video.description,isPublic:t.isPublic,isPublicLink:t.isPublicLink};t.$emit("loadingUploadVideo",e),n.path("/")}else i.error(o.NO_FILE_SELECTED,"left right bottom")},t.$watch("video.files",function(){t.video&&t.isValidFile(t.video)}),t.isValidFile=function(e){e.files&&e.files.length&&("video/mp4"!=e.files[0].type?i.error(o.FILE_TYPE_ERROR,"left right bottom"):e.files[0].size>o.FILE_SIZE_ALLOWED?i.error(o.FILE_SIZE_ERROR,"left right bottom"):t.fileName=e.files[0].name)}}]);